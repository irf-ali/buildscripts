{
  "steps":[
    {
      "args": [
        "clone",
        "https://github.com/google/oss-fuzz.git",
        "--depth",
        "1"
      ],
      "name": "gcr.io/cloud-builders/git"
    },
    {
      "name": "gcr.io/cloud-builders/docker",
      "args": [
        "build",
        "--tag",
        "gcr.io/oss-fuzz/apache-commons-lang",
        "."
      ],
      "dir": "oss-fuzz/projects/apache-commons-lang"
    },
    {
      "name": "gcr.io/oss-fuzz/apache-commons-lang",
      "args": [
        "bash",
        "-c",
        "srcmap > /workspace/srcmap.json && cat /workspace/srcmap.json"
      ],
      "env": [
        "OSSFUZZ_REVISION=$REVISION_ID",
        "FUZZING_LANGUAGE=jvm"
      ],
      "id": "srcmap"
    },
    {
      "name": "gcr.io/cloud-builders/docker",
      "env": [
        "ARCHITECTURE=x86_64",
        "FUZZING_ENGINE=libfuzzer",
        "FUZZING_LANGUAGE=jvm",
        "SANITIZER=coverage",
        "PROJECT_NAME=apache-commons-lang",
      ],
      "args": [
        "run",
        "--platform",
        "linux/amd64",
        "--privileged",
        "-i",
        "-e",
        "HELPER=True",
        "-e",
        "ARCHITECTURE=x86_64",
        "-e",
        "FUZZING_ENGINE=libfuzzer",
        "-e",
        "FUZZING_LANGUAGE=jvm",
        "-e",
        "PROJECT_NAME=apache-commons-lang",
        "-e",
        "SANITIZER=coverage",
        "-v",
        "oss-fuzz/build/out/apache-commons-lang/:/out",
        "-v",
        "oss-fuzz/build/work/apache-commons-lang:/work",
        "-t",
        "gcr.io/oss-fuzz/apache-commons-lang",
       ],
      "id": "compile-libfuzzer-coverage-x86_64"
    },
    {
      "name": "gcr.io/cloud-builders/gsutil",
      "entrypoint": "sh",
      "args": [
        "-c",
        "gsutil -m rm -rf gs://irali-test-cloudbuild/apache-commons-lang/build/out || exit 0"
      ]
    },
    {
      "name": "gcr.io/cloud-builders/gsutil",
      "args": [
        "-m",
        "cp",
        "-r",
        "oss-fuzz/build/out/apache-commons-lang/",
        "gs://irali-test-cloudbuild/apache-commons-lang"
      ]
    }
  ]
}
